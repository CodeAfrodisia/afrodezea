import{s}from"./index-D3n6H1Cv.js";const m=t=>(t??0)/100;function x(t){const a=Array.isArray(t.variants)?t.variants:[],n=a.length?a.map(c=>c.price_cents||0):[t.price_cents||0],r=Math.min(...n),o=Math.max(...n);return{id:t.id,title:t.title,handle:t.slug??t.handle??null,description:t.description||"",collection:t.collection||"",images:{nodes:t.image_url?[{url:t.image_url}]:[]},priceRange:{minVariantPrice:{amount:m(r),currencyCode:"USD"},maxVariantPrice:{amount:m(o),currencyCode:"USD"}},variants:{nodes:(a||[]).map(c=>({id:c.id??`${t.id}:${c.title??"default"}`,title:c.title??"Default",availableForSale:!!c.availableForSale,price:{amount:m(c.price_cents),currencyCode:"USD"},selectedOptions:c.selectedOptions||[]}))},options:Array.isArray(t.options)?t.options:[],collections:{nodes:t.collection?[{title:t.collection,handle:(t.collection||"").toLowerCase()}]:[]},tags:Array.isArray(t.tags)?t.tags:[],image_url:t.image_url||null,price_cents:t.price_cents??null}}async function D(t){let{data:a,error:n}=await s.from("products").select("*").eq("slug",t).maybeSingle();if(n?.code==="42703"||!a&&!n){const r=await s.from("products").select("*").eq("handle",t).maybeSingle();a=r.data,n=r.error}if(n)throw n;return a?x(a):null}async function F({q:t,tags:a,minPriceCents:n,maxPriceCents:r,order:o="new",page:c=1,pageSize:u=24}={}){const f=Math.max(0,(c-1)*u),b=f+u-1;let e=s.from("products").select("*",{count:"exact"});if(t&&t.trim()){const h=t.trim(),q=async()=>await s.from("products").select("*",{count:"exact"}).textSearch("ft",h,{type:"plain"}),_=async()=>{const l=`%${h}%`;return await s.from("products").select("*",{count:"exact"}).or(`title.ilike.${l},description.ilike.${l}`)};let d,i,p;try{({data:d,error:i,count:p}=await q()),i?.code==="42703"&&({data:d,error:i,count:p}=await _())}catch{({data:d,error:i,count:p}=await _())}if(i)throw i;const g=(d||[]).map(l=>l.id);if(g.length===0)return{rows:[],total:0,page:c,pageSize:u};e=s.from("products").select("*",{count:"exact"}).in("id",g)}a&&a.length&&(e=e.overlaps("tags",a)),typeof n=="number"&&(e=e.gte("price_cents",n)),typeof r=="number"&&(e=e.lte("price_cents",r)),o==="price_asc"?e=e.order("price_cents",{ascending:!0,nullsFirst:!0}):o==="price_desc"?e=e.order("price_cents",{ascending:!1,nullsLast:!0}):e=e.order("created_at",{ascending:!1,nullsLast:!0}),e=e.range(f,b);const{data:A,error:y,count:S}=await e;if(y)throw y;return{rows:(A||[]).map(x),total:S||0,page:c,pageSize:u}}export{D as f,F as s};
