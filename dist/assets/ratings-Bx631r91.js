import{s as o}from"./index-Cfo4WONF.js";const n="product_ratings",q="product_id,user_id";async function S(i){const{id:r,product_id:s,floral:t,fruity:e,citrus:a,woody:c,fresh:d,spicy:h,sweet:w,smoky:p,strength:v,comment:m,status:y,upsert:R=!0,user_id:g}=i??{},f={product_id:s,floral:t,fruity:e,citrus:a,woody:c,fresh:d,spicy:h,sweet:w,smoky:p,strength:v,...m!=null?{comment:m}:{},...y!=null?{status:y}:{},...g!=null?{user_id:g}:{}};if(r){const{data:l,error:u}=await o.from(n).update(f).eq("id",r).select().single();if(u)throw u;return l}if(R){const{data:l,error:u}=await o.from(n).upsert([f],{onConflict:q}).select().single();if(u)throw u;return l}const{data:k,error:_}=await o.from(n).insert([f]).select().single();if(_)throw _;return k}async function T(i){const{data:r,error:s}=await o.auth.getUser();if(s)throw s;const t=r?.user?.id;if(!t)return null;const{data:e,error:a}=await o.from(n).select("id, product_id, user_id, floral, fruity, citrus, woody, fresh, spicy, sweet, smoky, strength, comment, status, created_at, updated_at").eq("product_id",i).eq("user_id",t).limit(1).maybeSingle();if(a)throw a;return e||null}async function C(i){const{data:r,error:s}=await o.from(n).select("floral, fruity, citrus, woody, fresh, spicy, sweet, smoky, strength, status").eq("product_id",i).eq("status","verified");if(s)throw s;const t=r?.length??0,e=a=>t?Math.round(r.reduce((c,d)=>c+Number(d[a]??0),0)/t):0;return{count_verified:t,floral_avg:e("floral"),fruity_avg:e("fruity"),citrus_avg:e("citrus"),woody_avg:e("woody"),fresh_avg:e("fresh"),spicy_avg:e("spicy"),sweet_avg:e("sweet"),smoky_avg:e("smoky"),strength_avg:e("strength")}}async function E(i,r=6){const{data:s,error:t}=await o.from(n).select("id, created_at, comment, floral, fruity, citrus, woody, fresh, spicy, sweet, smoky, strength, status").eq("product_id",i).eq("status","verified").order("created_at",{ascending:!1}).limit(r);if(t)throw t;return s||[]}async function N({limit:i=100,status:r,q:s}={}){let t=o.from(n).select("*").order("created_at",{ascending:!1}).limit(i);if(r&&r!=="all"&&(t=t.eq("status",r)),s&&s.trim()){const c=`%${s.trim()}%`;t=t.or([`comment.ilike.${c}`,`product_id::text.ilike.${c}`].join(","))}const{data:e,error:a}=await t;if(a)throw a;return e||[]}export{E as a,T as b,C as f,N as l,S as s};
