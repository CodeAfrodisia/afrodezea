const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotesRadar-CQK1XroP.js","assets/index-Cfo4WONF.js","assets/index-BirdHXlw.css","assets/RateDrawer-BtHRycP7.js","assets/ratings-Bx631r91.js"])))=>i.map(i=>d[i]);
import{j as e,r as n,a as me,b as ye,c as xe,d as ve,e as re,g as be,L as ne,H as je,E as se,s as ie,_ as le}from"./index-Cfo4WONF.js";import{f as we}from"./productsSupabase-fJvJppfC.js";import{p as Se}from"./profileHeuristics-B2N-M0O0.js";import{f as ae,a as oe,b as _e}from"./ratings-Bx631r91.js";function ke(p){const h=Number(p??0);return Number.isNaN(h)?0:Math.max(0,Math.min(5,h))}function Me({value:p=0,label:h="Fragrance Strength"}){const b=ke(p),m=b>=5-1e-6,_=Math.min(100,b/5*100+.75);return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[e.jsx("div",{className:"heading",style:{fontSize:16},children:h}),e.jsxs("div",{style:{color:"var(--gold)",fontWeight:700},children:[b.toFixed(1)," / 5"]})]}),e.jsxs("div",{"aria-label":`Strength ${b.toFixed(1)} out of 5`,style:{position:"relative",height:12,borderRadius:9999,background:"linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), #0f0c0f",overflow:"hidden",boxShadow:"inset 0 0 0 1px var(--hairline)"},children:[e.jsx("div",{style:{width:m?"100%":`${_}%`,height:"100%",borderRadius:9999,background:"linear-gradient(90deg, #8a6b1f, #D4AF37 55%, #b89227)",willChange:"width",transform:"translateZ(0)"}}),[1,2,3,4].map(t=>e.jsx("div",{style:{position:"absolute",left:`${t/5*100}%`,top:0,bottom:0,width:1,background:"rgba(255,255,255,.12)",transform:"translateX(-0.5px)",pointerEvents:"none"}},t))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,color:"var(--muted)"},children:[e.jsx("span",{children:"Soft"}),e.jsx("span",{children:"Balanced"}),e.jsx("span",{children:"Bold"})]})]})}function Re({src:p,alt:h="",aspect:b=1,imgHints:m={}}){const _=n.useRef(null),t=n.useRef(null),[I,D]=n.useState(!1),[F,O]=n.useState({x:50,y:50}),[C,i]=n.useState(!1),[P,k]=n.useState(1),[L,l]=n.useState({x:0,y:0}),M=n.useRef(!1),x=n.useRef({x:0,y:0}),v=n.useMemo(()=>`${F.x}% ${F.y}%`,[F]);function E(a){const u=_.current;if(!u)return;const j=u.getBoundingClientRect(),R=(a.clientX-j.left)/j.width*100,w=(a.clientY-j.top)/j.height*100;O({x:Math.max(0,Math.min(100,R)),y:Math.max(0,Math.min(100,w))})}function W(a){a.preventDefault();const u=Math.max(1,Math.min(4,P+(a.deltaY<0?.15:-.15)));k(u)}function Y(a){M.current=!0,x.current={x:a.clientX,y:a.clientY}}function A(){M.current=!1}function T(a){if(!M.current)return;const u=a.clientX-x.current.x,j=a.clientY-x.current.y;x.current={x:a.clientX,y:a.clientY},l(R=>({x:R.x+u,y:R.y+j}))}return n.useEffect(()=>{if(!C)return;const a=u=>{u.key==="Escape"&&i(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[C]),e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:_,onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),onMouseMove:E,onClick:()=>{i(!0)},style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",aspectRatio:`${b} / 1`,backgroundImage:`url(${p})`,backgroundSize:I?"220%":"cover",backgroundPosition:I?v:"center",cursor:"zoom-in",backgroundColor:"#0a0a0a"},"aria-label":"Open zoomed image",children:e.jsx("img",{ref:t,src:p,alt:h,style:{width:"100%",height:"100%",objectFit:"cover",opacity:0},loading:m.loading,fetchpriority:m.fetchpriority,decoding:m.decoding,sizes:m.sizes})}),C&&e.jsx("div",{onClick:()=>i(!1),style:{position:"fixed",inset:0,zIndex:90,background:"rgba(0,0,0,.7)",display:"grid",placeItems:"center",cursor:"zoom-out"},children:e.jsxs("div",{onClick:a=>a.stopPropagation(),onWheel:W,onMouseDown:Y,onMouseUp:A,onMouseLeave:A,onMouseMove:T,style:{position:"relative",border:"1px solid var(--hairline)",borderRadius:16,overflow:"hidden",background:"#0a0a0a",maxWidth:"90vw",maxHeight:"85vh",touchAction:"none",cursor:M.current?"grabbing":"grab"},children:[e.jsx("img",{src:p,alt:h,style:{transform:`translate(${L.x}px, ${L.y}px) scale(${P})`},draggable:!1,loading:m.modalLoading||"eager",decoding:m.modalDecoding||"async"}),e.jsxs("div",{style:{position:"absolute",bottom:8,right:8,display:"flex",gap:6,background:"rgba(0,0,0,.5)",padding:"6px 8px",borderRadius:999,border:"1px solid var(--hairline)"},children:[e.jsx("button",{className:"btn btn--ghost",style:{padding:"2px 10px"},onClick:()=>k(a=>Math.max(1,a-.25)),children:"-"}),e.jsxs("span",{style:{minWidth:36,textAlign:"center",alignSelf:"center"},children:[Math.round(P*100),"%"]}),e.jsx("button",{className:"btn btn--gold",style:{padding:"2px 10px"},onClick:()=>k(a=>Math.min(4,a+.25)),children:"+"}),e.jsx("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>{k(1),l({x:0,y:0})},children:"Reset"}),e.jsx("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>i(!1),children:"Close"})]})]})})]})}const Ne=n.lazy(()=>le(()=>import("./NotesRadar-CQK1XroP.js"),__vite__mapDeps([0,1,2]))),Fe=n.lazy(()=>le(()=>import("./RateDrawer-BtHRycP7.js"),__vite__mapDeps([3,1,2,4])));function Be(){const{handle:p}=me(),h=ye(),{add:b}=xe(),{toggle:m,has:_}=ve(),[t,I]=n.useState(null),[D,F]=n.useState(!0),[O,C]=n.useState(!1),[i,P]=n.useState(null),[k,L]=n.useState([]),[l,M]=n.useState(null),{user:x}=re(),[v,E]=n.useState(null),W=n.useRef(null),[Y,A]=n.useState(0),T=t?.options||[],a=t?.variants?.nodes||[],u=new URLSearchParams(h.search),j=u.get("email")||"",R=u.get("fromQuick")==="1";n.useEffect(()=>{let r=!0;return(async()=>{F(!0);try{const o=await we(p);r&&I(o)}finally{r&&F(!1)}})(),()=>{r=!1}},[p]),n.useEffect(()=>{if(!t?.id)return;let r=!0;return(async()=>{try{const[o,s]=await Promise.all([ae(t.id),oe(t.id,6)]);if(!r)return;P(o),L(s),M(null)}catch{}})(),()=>{r=!1}},[t?.id]),n.useEffect(()=>{let r=!0;return(async()=>{if(!x?.id||!t?.id){r&&E(null);return}try{const o=await _e(t.id);r&&E(o||null)}catch{r&&E(null)}})(),()=>{r=!1}},[x?.id,t?.id,O]),n.useEffect(()=>{if(!R)return;const r=document.querySelector(".surface");r&&(r.style.animation="fadeUp .18s ease both")},[R]),n.useEffect(()=>{function r(){if(!W.current)return;const o=W.current.getBoundingClientRect(),s=Math.max(1,window.innerHeight),d=Math.max(0,Math.min(1,1-o.top/s));A(d*10)}return r(),window.addEventListener("scroll",r,{passive:!0}),()=>window.removeEventListener("scroll",r)},[]);const[w,X]=n.useState({});n.useEffect(()=>{if(!a.length){X({});return}const r=a.find(s=>s.availableForSale)||a[0],o={};(r.selectedOptions||[]).forEach(s=>{o[s.name]=s.value}),X(o)},[t?.id,a.length]);const V=r=>String(r??"").toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]+/g,""),S=n.useMemo(()=>{if(!a.length)return null;const r=a.find(s=>(s.selectedOptions||[]).every(g=>V(w[g.name])===V(g.value)));if(r)return r;const o=Object.keys(w);if(o.length){const s=a.find(d=>{const g=Object.fromEntries((d.selectedOptions||[]).map(y=>[y.name,y.value]));return o.every(y=>V(w[y])===V(g[y]))});if(s)return s}return a[0]||null},[a,w]),q=n.useMemo(()=>S?.price?.amount!=null?Number(S.price.amount):t?.priceRange?.minVariantPrice?.amount!=null?Number(t.priceRange.minVariantPrice.amount):t?.price_cents!=null?t.price_cents/100:0,[S,t]),H=be(),z=n.useMemo(()=>t?.image_url||t?.images?.nodes?.[0]?.url||"",[t]),ce=n.useMemo(()=>{if(!t)return 0;const r=t.priceRange?.minVariantPrice?.amount;return r!=null?Number(r):(t.price_cents??0)/100},[t]),G=n.useMemo(()=>t?`${H}/product/${t.handle||t.slug}`:H,[H,t]),K=n.useMemo(()=>t?`${t.title} | Afrodezea`:"Afrodezea",[t]),J=n.useMemo(()=>t?(t.description||"").replace(/<[^>]+>/g,"").slice(0,155):"",[t]),ee=n.useMemo(()=>t?_(t.id):!1,[t,_]),N=n.useMemo(()=>{const r=(t?.description||"").replace(/<[^>]+>/g," ");return Se(r)},[t]),c=n.useMemo(()=>t?.profile?{Floral:t.profile.floral??0,Fruity:t.profile.fruity??0,Woody:t.profile.woody??0,Fresh:t.profile.fresh??0,Spicy:t.profile.spice??0,Strength:t.profile.strength??0}:{Floral:N.floral,Fruity:N.fruity,Woody:N.woody,Fresh:N.fresh,Spicy:N.spicy,Strength:N.strength},[t,N]),Q=n.useMemo(()=>{if(!i)return null;const r={Floral:i.floral_avg,Fruity:i.fruity_avg,Woody:i.woody_avg,Fresh:i.fresh_avg,Spicy:i.spicy_avg,Strength:i.strength_avg};if(!l)return r;const o=Number(i.count_verified||0),s=(d,g)=>Math.round((Number(d||0)*o+Number(g||0))/(o+1));return{Floral:s(r.Floral,l.floral),Fruity:s(r.Fruity,l.fruity),Woody:s(r.Woody,l.woody),Fresh:s(r.Fresh,l.fresh),Spicy:s(r.Spicy,l.spicy),Strength:s(r.Strength,l.strength)}},[i,l]);n.useMemo(()=>{if(!Q)return c;const r=["Floral","Fruity","Woody","Fresh","Spicy","Strength"],o={};return r.forEach(s=>{o[s]=Math.round(((c[s]??0)+(Q[s]??0))/2)}),o},[c,Q]);const te=n.useMemo(()=>({floral:c.Floral??0,fruity:c.Fruity??0,citrus:c.Citrus??0,fresh:c.Fresh??0,woody:c.Woody??0,spicy:c.Spicy??0,sweet:c.Sweet??0,smoky:c.Smoky??0}),[c]),f=n.useMemo(()=>i?{floral:i.floral_avg??0,fruity:i.fruity_avg??0,citrus:i.citrus_avg??0,fresh:i.fresh_avg??0,woody:i.woody_avg??0,spicy:i.spicy_avg??0,sweet:i.sweet_avg??0,smoky:i.smoky_avg??0,count:i.count_verified??0}:null,[i]),$=n.useMemo(()=>{if(!f)return null;if(!v)return f;const r=f.count||0,o=["floral","fruity","citrus","fresh","woody","spicy","sweet","smoky"],s={};for(const d of o){const g=Number(f[d]??0),y=Number(v[d]??0);s[d]=Math.round((g*r+y)/(r+1))}return s},[f,v]),de=n.useMemo(()=>$||f||te,[$,f,te]),ue=n.useMemo(()=>v?.strength!=null?Number(v.strength):l?.strength!=null?Number(l.strength):$&&Number.isFinite($.strength)?Number($.strength):f&&Number.isFinite(f.strength)?Number(f.strength):Number(c?.Strength??0),[v,l,$,f,c]);if(D)return e.jsx("div",{style:{padding:24},children:"Loading…"});if(!t)return e.jsx("div",{style:{padding:24},children:"Not found."});function fe({productId:r}){const{user:o}=re(),s=o?.id,d=async()=>{if(!s){alert("Please log in first.");return}const{data:g,error:y}=await ie.from("user_item_rankings").select("rank").eq("user_id",s).order("rank",{ascending:!1}).limit(1);y&&console.warn("rank lookup failed",y);const pe=g?.[0]?.rank?g[0].rank+1:1,{error:he}=await ie.from("user_item_rankings").upsert([{user_id:s,item_id:r,rank:pe,is_public:!1}],{onConflict:"user_id,item_id"});if(he){alert("Failed to add to favorites.");return}alert("Added to favorites!")};return e.jsx("button",{onClick:d,className:"chip",style:{padding:"10px 14px"},children:"☆ Add to Favorites"})}const ge={"@context":"https://schema.org","@type":"Product",name:t.title,image:t.image_url?[t.image_url]:[],description:J,brand:{"@type":"Brand",name:"Afrodezea"},offers:{"@type":"Offer",priceCurrency:"USD",price:Number(ce).toFixed(2),availability:"https://schema.org/InStock",url:G},...i?.count_verified>0?{aggregateRating:{"@type":"AggregateRating",ratingValue:Math.round((i.floral_avg+i.fruity_avg+i.woody_avg+i.fresh_avg+i.spicy_avg)/5*10)/10,reviewCount:i.count_verified}}:{}},U=a.length&&S?S.availableForSale!==!1:!0,B=h.state?.from;let Z="/products";if(B&&(B.search||B.pathname))Z=`${B.pathname}${B.search||""}`;else try{const r=sessionStorage.getItem("afd:lastProductsSearch");r&&(Z=`/products${r}`)}catch{}return e.jsxs("div",{className:"container",style:{padding:24,display:"grid",gap:18},children:[e.jsx("div",{children:B?e.jsx(ne,{to:Z,className:"btn btn--ghost","aria-label":"Back to results",children:"← Back to results"}):e.jsx(ne,{to:"/products",className:"btn btn--ghost",children:"← Products"})}),e.jsxs(je,{children:[e.jsx("title",{children:K}),e.jsx("meta",{name:"description",content:J}),e.jsx("link",{rel:"canonical",href:G}),e.jsx("meta",{property:"og:type",content:"product"}),e.jsx("meta",{property:"og:title",content:K}),e.jsx("meta",{property:"og:description",content:J}),e.jsx("meta",{property:"og:url",content:G}),t.image_url&&e.jsx("meta",{property:"og:image",content:t.image_url}),e.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),e.jsx("script",{type:"application/ld+json",children:JSON.stringify(ge)})]}),e.jsx("section",{className:"surface",style:{padding:18},children:e.jsxs("div",{style:{display:"grid",gap:20,gridTemplateColumns:"min(560px, 42vw) 1fr",alignItems:"start"},children:[e.jsx("div",{ref:W,style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",background:"#0a0a0a",aspectRatio:"1 / 1",transform:`translateY(${Y}px)`,transition:"transform .08s linear",willChange:"transform"},children:z?e.jsx(se,{fallback:e.jsx("div",{style:{opacity:.8},children:"Gallery is unavailable."}),children:e.jsx(Re,{src:z,alt:t.title,aspect:1,imgHints:{loading:"eager",fetchpriority:"high",decoding:"async",sizes:"(min-width: 900px) 560px, 90vw"}})}):null}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("div",{style:{borderBottom:"1px solid var(--hairline)",paddingBottom:12},children:[e.jsx("h1",{className:"display",style:{marginBottom:4},children:t.title}),t.collection&&e.jsx("div",{style:{opacity:.75},children:t.collection})]}),k?.length?e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:12},children:k.map(r=>e.jsxs("span",{style:{padding:"6px 10px",borderRadius:999,border:"1px solid var(--hairline)",opacity:.85},children:[new Date(r.created_at).toLocaleDateString()," • Str ",r.strength]},r.id))}):null,T?.length?e.jsx("div",{style:{display:"grid",gap:10,marginTop:8},children:T.map(r=>e.jsxs("div",{children:[e.jsx("div",{style:{opacity:.8,marginBottom:6},children:r.name}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:(r.values||[]).map(o=>{const s=w[r.name]===o;return e.jsx("button",{type:"button",className:`chip ${s?"active":""}`,style:{padding:"6px 10px",borderRadius:999,border:"1px solid var(--hairline)",background:s?"rgba(212,175,55,.12)":"transparent"},onClick:()=>X(d=>({...d,[r.name]:o})),"aria-pressed":s,children:o},o)})})]},r.name))}):null,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("strong",{style:{color:"var(--gold)",fontSize:22},children:new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(q)}),e.jsx("button",{className:"btn btn--gold",disabled:!U,"aria-disabled":!U,title:U?void 0:"This variant is currently unavailable",onClick:()=>b({productId:t.id,title:t.title,variantId:S?.id?`${t.id}:${S.id}`:`${t.id}:default`,variantTitle:S?.title||"Default",image:z?{url:z}:null,price:{amount:q,currencyCode:"USD"},qty:1,selectedOptions:w}),children:U?"Add to Cart":"Unavailable"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>m(t.id,{title:t.title,handle:t.handle??t.slug??null,image_url:z||null,price_cents:t.price_cents??Math.round(Number(q||0)*100),priceRange:t.priceRange||null}),"aria-pressed":ee,children:ee?"Remove from Wishlist":"Add to Wishlist"}),e.jsx(fe,{productId:t.id})]}),t.description&&e.jsx("p",{style:{marginTop:8,opacity:.9},children:t.description})]})]})}),e.jsxs("section",{className:"surface",style:{padding:18},children:[e.jsx("h3",{style:{margin:0,marginBottom:12},children:"Scent Profile"}),e.jsxs("div",{style:{display:"grid",gap:16,gridTemplateColumns:"min(380px, 40%) 1fr",alignItems:"center"},children:[e.jsx(n.Suspense,{fallback:null,children:e.jsx(se,{fallback:e.jsx("div",{style:{opacity:.8},children:"Profile visualization unavailable."}),children:e.jsx(Ne,{profile:de,chartScale:.7})})}),e.jsxs("div",{children:[e.jsx("p",{className:"lead",style:{marginTop:0},children:i?.count_verified?e.jsxs(e.Fragment,{children:["Blended from ",e.jsxs("strong",{children:[i.count_verified," verified rating",i.count_verified>1?"s":""]}),l?" + your new rating (pending review)":""," + our profile."]}):l?"Blended with your rating (pending review) + our profile.":"Be the first to rate this profile."}),e.jsx("div",{style:{maxWidth:520,marginTop:10},children:e.jsx(Me,{value:ue})}),e.jsx("div",{style:{marginTop:12},children:e.jsx("button",{className:"btn btn--gold",onClick:()=>C(!0),children:"Rate this Candle’s Profile"})})]})]})]}),e.jsx(n.Suspense,{fallback:null,children:e.jsx(Fe,{open:O,onClose:()=>C(!1),product:t,prefillEmail:j,existingRating:v,userId:x?.id,onSubmitted:r=>{E({...r,user_id:x?.id||null,product_id:t.id}),M({floral:r.floral,fruity:r.fruity,citrus:r.citrus,woody:r.woody,fresh:r.fresh,spicy:r.spicy,sweet:r.sweet,smoky:r.smoky,strength:r.strength}),(async()=>{try{const[o,s]=await Promise.all([ae(t.id),oe(t.id,6)]);P(o),L(s)}catch{}})()}})})]})}export{Be as default};
