const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotesRadar-DQQsafu8.js","assets/index-Du-y3j9l.js","assets/index-CPw1xV8w.css","assets/RateDrawer-CR1tw9Xd.js","assets/ratings-BrickCnm.js"])))=>i.map(i=>d[i]);
import{R as e,r as n,a as j,b as X,c as q,d as H,g as G,L as A,H as Q,E as O,_ as Y}from"./index-Du-y3j9l.js";import{f as J}from"./productsSupabase-C9KWaEbR.js";import{p as K}from"./profileHeuristics-B2N-M0O0.js";import{f as Z,a as ee}from"./ratings-BrickCnm.js";function te(i){const l=Number(i??0);return Number.isNaN(l)?0:Math.max(0,Math.min(5,l))}function ne({value:i=0,label:l="Fragrance Strength"}){const g=te(i),c=g/5*100;return e.createElement("div",{style:{display:"grid",gap:8}},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"}},e.createElement("div",{className:"heading",style:{fontSize:16}},l),e.createElement("div",{style:{color:"var(--gold)",fontWeight:700}},g.toFixed(1)," / 5")),e.createElement("div",{"aria-label":`Strength ${g.toFixed(1)} out of 5`,style:{position:"relative",height:12,borderRadius:999,border:"1px solid var(--hairline)",background:"linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), #0f0c0f",overflow:"hidden"}},e.createElement("div",{style:{width:`${c}%`,height:"100%",background:"linear-gradient(90deg, #8a6b1f, #D4AF37 55%, #b89227)"}}),[1,2,3,4].map(u=>e.createElement("div",{key:u,style:{position:"absolute",left:`${u/5*100}%`,top:0,bottom:0,width:1,background:"rgba(255,255,255,.12)",transform:"translateX(-0.5px)"}}))),e.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,color:"var(--muted)"}},e.createElement("span",null,"Soft"),e.createElement("span",null,"Balanced"),e.createElement("span",null,"Bold")))}function ae({src:i,alt:l="",aspect:g=1,imgHints:c={}}){const u=n.useRef(null),t=n.useRef(null),[N,C]=n.useState(!1),[v,L]=n.useState({x:50,y:50}),[E,o]=n.useState(!1),[R,f]=n.useState(1),[P,b]=n.useState({x:0,y:0}),x=n.useRef(!1),S=n.useRef({x:0,y:0}),w=n.useMemo(()=>`${v.x}% ${v.y}%`,[v]);function W(a){const s=u.current;if(!s)return;const d=s.getBoundingClientRect(),m=(a.clientX-d.left)/d.width*100,z=(a.clientY-d.top)/d.height*100;L({x:Math.max(0,Math.min(100,m)),y:Math.max(0,Math.min(100,z))})}function B(a){a.preventDefault();const s=Math.max(1,Math.min(4,R+(a.deltaY<0?.15:-.15)));f(s)}function $(a){x.current=!0,S.current={x:a.clientX,y:a.clientY}}function _(){x.current=!1}function y(a){if(!x.current)return;const s=a.clientX-S.current.x,d=a.clientY-S.current.y;S.current={x:a.clientX,y:a.clientY},b(m=>({x:m.x+s,y:m.y+d}))}return n.useEffect(()=>{if(!E)return;const a=s=>{s.key==="Escape"&&o(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[E]),e.createElement(e.Fragment,null,e.createElement("div",{ref:u,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),onMouseMove:W,onClick:()=>{o(!0)},style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",aspectRatio:`${g} / 1`,backgroundImage:`url(${i})`,backgroundSize:N?"220%":"cover",backgroundPosition:N?w:"center",cursor:"zoom-in",backgroundColor:"#0a0a0a"},"aria-label":"Open zoomed image"},e.createElement("img",{ref:t,src:i,alt:l,style:{width:"100%",height:"100%",objectFit:"cover",opacity:0},loading:c.loading,fetchpriority:c.fetchpriority,decoding:c.decoding,sizes:c.sizes})),E&&e.createElement("div",{onClick:()=>o(!1),style:{position:"fixed",inset:0,zIndex:90,background:"rgba(0,0,0,.7)",display:"grid",placeItems:"center",cursor:"zoom-out"}},e.createElement("div",{onClick:a=>a.stopPropagation(),onWheel:B,onMouseDown:$,onMouseUp:_,onMouseLeave:_,onMouseMove:y,style:{position:"relative",border:"1px solid var(--hairline)",borderRadius:16,overflow:"hidden",background:"#0a0a0a",maxWidth:"90vw",maxHeight:"85vh",touchAction:"none",cursor:x.current?"grabbing":"grab"}},e.createElement("img",{src:i,alt:l,style:{transform:`translate(${P.x}px, ${P.y}px) scale(${R})`},draggable:!1,loading:c.modalLoading||"eager",decoding:c.modalDecoding||"async"}),e.createElement("div",{style:{position:"absolute",bottom:8,right:8,display:"flex",gap:6,background:"rgba(0,0,0,.5)",padding:"6px 8px",borderRadius:999,border:"1px solid var(--hairline)"}},e.createElement("button",{className:"btn btn--ghost",style:{padding:"2px 10px"},onClick:()=>f(a=>Math.max(1,a-.25))},"-"),e.createElement("span",{style:{minWidth:36,textAlign:"center",alignSelf:"center"}},Math.round(R*100),"%"),e.createElement("button",{className:"btn btn--gold",style:{padding:"2px 10px"},onClick:()=>f(a=>Math.min(4,a+.25))},"+"),e.createElement("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>{f(1),b({x:0,y:0})}},"Reset"),e.createElement("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>o(!1)},"Close")))))}const re=n.lazy(()=>Y(()=>import("./NotesRadar-DQQsafu8.js"),__vite__mapDeps([0,1,2]))),oe=n.lazy(()=>Y(()=>import("./RateDrawer-CR1tw9Xd.js"),__vite__mapDeps([3,1,2,4])));function ie(i=0,l="USD"){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:l}).format(i)}catch{return`$${Number(i).toFixed(2)}`}}function ue(){const{handle:i}=j(),l=X(),{add:g}=q(),{toggle:c,has:u}=H(),[t,N]=n.useState(null),[C,v]=n.useState(!0),[L,E]=n.useState(!1),[o,R]=n.useState(null),[f,P]=n.useState([]),b=n.useRef(null),[x,S]=n.useState(0),w=new URLSearchParams(l.search),W=w.get("rateToken")||w.get("rt")||"",B=w.get("email")||"",$=w.get("fromQuick")==="1";n.useEffect(()=>{let r=!0;return(async()=>{v(!0);try{const p=await J(i);r&&N(p)}finally{r&&v(!1)}})(),()=>{r=!1}},[i]),n.useEffect(()=>{t?.id&&(async()=>{const[r,p]=await Promise.all([Z(t.id),ee(t.id,6)]);R(r),P(p)})()},[t?.id]),n.useEffect(()=>{if(!$)return;const r=document.querySelector(".surface");r&&(r.style.animation="fadeUp .18s ease both")},[$]),n.useEffect(()=>{function r(){if(!b.current)return;const p=b.current.getBoundingClientRect(),F=Math.max(1,window.innerHeight),V=Math.max(0,Math.min(1,1-p.top/F));S(V*10)}return r(),window.addEventListener("scroll",r,{passive:!0}),()=>window.removeEventListener("scroll",r)},[]);const _=G(),y=n.useMemo(()=>t?.image_url||t?.images?.nodes?.[0]?.url||"",[t]),a=n.useMemo(()=>{if(!t)return 0;const r=t.priceRange?.minVariantPrice?.amount;return r!=null?Number(r):(t.price_cents??0)/100},[t]),s=n.useMemo(()=>t?`${_}/product/${t.handle||t.slug}`:_,[_,t]),d=n.useMemo(()=>t?`${t.title} | Afrodezea`:"Afrodezea",[t]),m=n.useMemo(()=>t?(t.description||"").replace(/<[^>]+>/g,"").slice(0,155):"",[t]),z=n.useMemo(()=>t?u(t.id):!1,[t,u]),h=n.useMemo(()=>{const r=(t?.description||"").replace(/<[^>]+>/g," ");return K(r)},[t]),D=n.useMemo(()=>t?.profile?{Floral:t.profile.floral??0,Fruity:t.profile.fruity??0,Woody:t.profile.woody??0,Fresh:t.profile.fresh??0,Spicy:t.profile.spice??0,Strength:t.profile.strength??0}:{Floral:h.floral,Fruity:h.fruity,Woody:h.woody,Fresh:h.fresh,Spicy:h.spicy,Strength:h.strength},[t,h]),I=n.useMemo(()=>o?{Floral:o.floral_avg,Fruity:o.fruity_avg,Woody:o.woody_avg,Fresh:o.fresh_avg,Spicy:o.spicy_avg,Strength:o.strength_avg}:null,[o]),k=n.useMemo(()=>{if(!I)return D;const r=["Floral","Fruity","Woody","Fresh","Spicy","Strength"],p={};return r.forEach(F=>{p[F]=Math.round(((D[F]??0)+(I[F]??0))/2)}),p},[D,I]);if(C)return e.createElement("div",{style:{padding:24}},"Loading…");if(!t)return e.createElement("div",{style:{padding:24}},"Not found.");const U={"@context":"https://schema.org","@type":"Product",name:t.title,image:t.image_url?[t.image_url]:[],description:m,brand:{"@type":"Brand",name:"Afrodezea"},offers:{"@type":"Offer",priceCurrency:"USD",price:Number(a).toFixed(2),availability:"https://schema.org/InStock",url:s},...o?.count_verified>0?{aggregateRating:{"@type":"AggregateRating",ratingValue:Math.round((o.floral_avg+o.fruity_avg+o.woody_avg+o.fresh_avg+o.spicy_avg)/5*10)/10,reviewCount:o.count_verified}}:{}},M=l.state?.from;let T="/products";if(M&&(M.search||M.pathname))T=`${M.pathname}${M.search||""}`;else try{const r=sessionStorage.getItem("afd:lastProductsSearch");r&&(T=`/products${r}`)}catch{}return e.createElement("div",{className:"container",style:{padding:24,display:"grid",gap:18}},e.createElement("div",null,M?e.createElement(A,{to:T,className:"btn btn--ghost","aria-label":"Back to results"},"← Back to results"):e.createElement(A,{to:"/products",className:"btn btn--ghost"},"← Products")),e.createElement(Q,null,e.createElement("title",null,d),e.createElement("meta",{name:"description",content:m}),e.createElement("link",{rel:"canonical",href:s}),e.createElement("meta",{property:"og:type",content:"product"}),e.createElement("meta",{property:"og:title",content:d}),e.createElement("meta",{property:"og:description",content:m}),e.createElement("meta",{property:"og:url",content:s}),t.image_url&&e.createElement("meta",{property:"og:image",content:t.image_url}),e.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),e.createElement("script",{type:"application/ld+json"},JSON.stringify(U))),e.createElement("section",{className:"surface",style:{padding:18}},e.createElement("div",{style:{display:"grid",gap:20,gridTemplateColumns:"min(560px, 42vw) 1fr",alignItems:"start"}},e.createElement("div",{ref:b,style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",background:"#0a0a0a",aspectRatio:"1 / 1",transform:`translateY(${x}px)`,transition:"transform .08s linear",willChange:"transform"}},y?e.createElement(O,{fallback:e.createElement("div",{style:{opacity:.8}},"Gallery is unavailable.")},e.createElement(ae,{src:y,alt:t.title,aspect:1,imgHints:{loading:"eager",fetchpriority:"high",decoding:"async",sizes:"(min-width: 900px) 560px, 90vw"}})):null),e.createElement("div",{style:{display:"grid",gap:12}},e.createElement("div",{style:{borderBottom:"1px solid var(--hairline)",paddingBottom:12}},e.createElement("h1",{className:"display",style:{marginBottom:4}},t.title),t.collection&&e.createElement("div",{style:{opacity:.75}},t.collection)),f?.length?e.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:12}},f.map(r=>e.createElement("span",{key:r.id,style:{padding:"6px 10px",borderRadius:999,border:"1px solid var(--hairline)",opacity:.85}},new Date(r.created_at).toLocaleDateString()," • Str ",r.strength))):null,e.createElement("div",{style:{display:"flex",alignItems:"center",gap:12}},e.createElement("strong",{style:{color:"var(--gold)",fontSize:22}},ie(a)),e.createElement("button",{className:"btn btn--gold",onClick:()=>g({productId:t.id,title:t.title,variantId:`${t.id}:default`,variantTitle:"Default",image:y?{url:y}:null,price:{amount:a,currencyCode:"USD"},qty:1})},"Add to Cart"),e.createElement("button",{className:"btn btn--ghost",onClick:()=>c(t.id,{title:t.title,handle:t.handle??t.slug??null,image_url:y||null,price_cents:t.price_cents??Math.round(Number(a||0)*100),priceRange:t.priceRange||null}),"aria-pressed":z},z?"Remove from Wishlist":"Add to Wishlist")),t.description&&e.createElement("p",{style:{marginTop:8,opacity:.9}},t.description)))),e.createElement("section",{className:"surface",style:{padding:18}},e.createElement("h3",{style:{margin:0,marginBottom:12}},"Scent Profile"),e.createElement("div",{style:{display:"grid",gap:16,gridTemplateColumns:"min(380px, 40%) 1fr",alignItems:"center"}},e.createElement(n.Suspense,{fallback:null},e.createElement(O,{fallback:e.createElement("div",{style:{opacity:.8}},"Profile visualization unavailable.")},e.createElement(re,{values:{Floral:k.Floral,Fruity:k.Fruity,Woody:k.Woody,Fresh:k.Fresh,Spicy:k.Spicy}}))),e.createElement("div",null,e.createElement("p",{className:"lead",style:{marginTop:0}},o?.count_verified?e.createElement(e.Fragment,null,"Blended from ",e.createElement("strong",null,o.count_verified," verified rating",o.count_verified>1?"s":"")," + our profile."):"Be the first to rate this profile."),e.createElement("div",{style:{maxWidth:520,marginTop:10}},e.createElement(ne,{value:k.Strength})),e.createElement("div",{style:{marginTop:12}},e.createElement("button",{className:"btn btn--gold",onClick:()=>E(!0)},"Rate this Candle’s Profile"))))),e.createElement(n.Suspense,{fallback:null},e.createElement(oe,{open:L,onClose:()=>E(!1),product:t,prefillEmail:B,rateToken:W})))}export{ue as default};
