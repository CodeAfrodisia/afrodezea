import{s as o}from"./index-Du-y3j9l.js";const c="product_ratings";async function l(a){const e={status:"pending",...a},{data:r,error:t}=await o.from(c).insert([e]).select().single();if(t)throw t;return r}async function u({limit:a=100,status:e,q:r}={}){let t=o.from(c).select("*").order("created_at",{ascending:!1}).limit(a);if(e&&e!=="all"&&(t=t.eq("status",e)),r&&r.trim()){const s=`%${r.trim()}%`;t=t.or([`email.ilike.${s}`,`comment.ilike.${s}`,`product_id::text.ilike.${s}`].join(","))}const{data:i,error:n}=await t;if(n)throw n;return i||[]}async function g(a){const{data:e,error:r}=await o.from("ratings").select("floral, fruity, woody, fresh, spicy, strength, status",{count:"exact"}).eq("product_id",a).eq("status","verified");if(r)throw r;const t=e?.length??0,i=n=>t?Math.round(e.reduce((s,f)=>s+Number(f[n]??0),0)/t):0;return{count_verified:t,floral_avg:i("floral"),fruity_avg:i("fruity"),woody_avg:i("woody"),fresh_avg:i("fresh"),spicy_avg:i("spicy"),strength_avg:i("strength")}}async function m(a,e=6){const{data:r,error:t}=await o.from("ratings").select("id, created_at, comment, floral, fruity, woody, fresh, spicy, strength").eq("product_id",a).eq("status","verified").order("created_at",{ascending:!1}).limit(e);if(t)throw t;return r||[]}export{m as a,g as f,u as l,l as s};
