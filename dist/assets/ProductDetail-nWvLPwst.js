const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotesRadar-DJkeaLSL.js","assets/index-D3n6H1Cv.js","assets/index-CPw1xV8w.css","assets/RateDrawer-DLQeaIF5.js","assets/ratings-DY0tlNBI.js"])))=>i.map(i=>d[i]);
import{R as e,r as n,a as Y,b as U,c as V,d as j,g as X,H as q,E as I,_ as T}from"./index-D3n6H1Cv.js";import{f as G}from"./productsSupabase-Dmcm6j9L.js";import{p as H}from"./profileHeuristics-B2N-M0O0.js";import{f as Q,a as J}from"./ratings-DY0tlNBI.js";function K(i){const s=Number(i??0);return Number.isNaN(s)?0:Math.max(0,Math.min(5,s))}function Z({value:i=0,label:s="Fragrance Strength"}){const g=K(i),c=g/5*100;return e.createElement("div",{style:{display:"grid",gap:8}},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"}},e.createElement("div",{className:"heading",style:{fontSize:16}},s),e.createElement("div",{style:{color:"var(--gold)",fontWeight:700}},g.toFixed(1)," / 5")),e.createElement("div",{"aria-label":`Strength ${g.toFixed(1)} out of 5`,style:{position:"relative",height:12,borderRadius:999,border:"1px solid var(--hairline)",background:"linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), #0f0c0f",overflow:"hidden"}},e.createElement("div",{style:{width:`${c}%`,height:"100%",background:"linear-gradient(90deg, #8a6b1f, #D4AF37 55%, #b89227)"}}),[1,2,3,4].map(u=>e.createElement("div",{key:u,style:{position:"absolute",left:`${u/5*100}%`,top:0,bottom:0,width:1,background:"rgba(255,255,255,.12)",transform:"translateX(-0.5px)"}}))),e.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12,color:"var(--muted)"}},e.createElement("span",null,"Soft"),e.createElement("span",null,"Balanced"),e.createElement("span",null,"Bold")))}function ee({src:i,alt:s="",aspect:g=1,imgHints:c={}}){const u=n.useRef(null),t=n.useRef(null),[F,C]=n.useState(!1),[v,W]=n.useState({x:50,y:50}),[E,a]=n.useState(!1),[R,f]=n.useState(1),[N,b]=n.useState({x:0,y:0}),x=n.useRef(!1),S=n.useRef({x:0,y:0}),w=n.useMemo(()=>`${v.x}% ${v.y}%`,[v]);function $(r){const l=u.current;if(!l)return;const d=l.getBoundingClientRect(),m=(r.clientX-d.left)/d.width*100,z=(r.clientY-d.top)/d.height*100;W({x:Math.max(0,Math.min(100,m)),y:Math.max(0,Math.min(100,z))})}function D(r){r.preventDefault();const l=Math.max(1,Math.min(4,R+(r.deltaY<0?.15:-.15)));f(l)}function P(r){x.current=!0,S.current={x:r.clientX,y:r.clientY}}function _(){x.current=!1}function y(r){if(!x.current)return;const l=r.clientX-S.current.x,d=r.clientY-S.current.y;S.current={x:r.clientX,y:r.clientY},b(m=>({x:m.x+l,y:m.y+d}))}return n.useEffect(()=>{if(!E)return;const r=l=>{l.key==="Escape"&&a(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[E]),e.createElement(e.Fragment,null,e.createElement("div",{ref:u,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),onMouseMove:$,onClick:()=>{a(!0)},style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",aspectRatio:`${g} / 1`,backgroundImage:`url(${i})`,backgroundSize:F?"220%":"cover",backgroundPosition:F?w:"center",cursor:"zoom-in",backgroundColor:"#0a0a0a"},"aria-label":"Open zoomed image"},e.createElement("img",{ref:t,src:i,alt:s,style:{width:"100%",height:"100%",objectFit:"cover",opacity:0},loading:c.loading,fetchpriority:c.fetchpriority,decoding:c.decoding,sizes:c.sizes})),E&&e.createElement("div",{onClick:()=>a(!1),style:{position:"fixed",inset:0,zIndex:90,background:"rgba(0,0,0,.7)",display:"grid",placeItems:"center",cursor:"zoom-out"}},e.createElement("div",{onClick:r=>r.stopPropagation(),onWheel:D,onMouseDown:P,onMouseUp:_,onMouseLeave:_,onMouseMove:y,style:{position:"relative",border:"1px solid var(--hairline)",borderRadius:16,overflow:"hidden",background:"#0a0a0a",maxWidth:"90vw",maxHeight:"85vh",touchAction:"none",cursor:x.current?"grabbing":"grab"}},e.createElement("img",{src:i,alt:s,style:{transform:`translate(${N.x}px, ${N.y}px) scale(${R})`},draggable:!1,loading:c.modalLoading||"eager",decoding:c.modalDecoding||"async"}),e.createElement("div",{style:{position:"absolute",bottom:8,right:8,display:"flex",gap:6,background:"rgba(0,0,0,.5)",padding:"6px 8px",borderRadius:999,border:"1px solid var(--hairline)"}},e.createElement("button",{className:"btn btn--ghost",style:{padding:"2px 10px"},onClick:()=>f(r=>Math.max(1,r-.25))},"-"),e.createElement("span",{style:{minWidth:36,textAlign:"center",alignSelf:"center"}},Math.round(R*100),"%"),e.createElement("button",{className:"btn btn--gold",style:{padding:"2px 10px"},onClick:()=>f(r=>Math.min(4,r+.25))},"+"),e.createElement("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>{f(1),b({x:0,y:0})}},"Reset"),e.createElement("button",{className:"btn",style:{padding:"2px 10px"},onClick:()=>a(!1)},"Close")))))}const te=n.lazy(()=>T(()=>import("./NotesRadar-DJkeaLSL.js"),__vite__mapDeps([0,1,2]))),ne=n.lazy(()=>T(()=>import("./RateDrawer-DLQeaIF5.js"),__vite__mapDeps([3,1,2,4])));function re(i=0,s="USD"){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s}).format(i)}catch{return`$${Number(i).toFixed(2)}`}}function se(){const{handle:i}=Y(),s=U(),{add:g}=V(),{toggle:c,has:u}=j(),[t,F]=n.useState(null),[C,v]=n.useState(!0),[W,E]=n.useState(!1),[a,R]=n.useState(null),[f,N]=n.useState([]),b=n.useRef(null),[x,S]=n.useState(0),w=new URLSearchParams(s.search),$=w.get("rateToken")||w.get("rt")||"",D=w.get("email")||"",P=w.get("fromQuick")==="1";n.useEffect(()=>{let o=!0;return(async()=>{v(!0);try{const p=await G(i);o&&F(p)}finally{o&&v(!1)}})(),()=>{o=!1}},[i]),n.useEffect(()=>{t?.id&&(async()=>{const[o,p]=await Promise.all([Q(t.id),J(t.id,6)]);R(o),N(p)})()},[t?.id]),n.useEffect(()=>{if(!P)return;const o=document.querySelector(".surface");o&&(o.style.animation="fadeUp .18s ease both")},[P]),n.useEffect(()=>{function o(){if(!b.current)return;const p=b.current.getBoundingClientRect(),k=Math.max(1,window.innerHeight),O=Math.max(0,Math.min(1,1-p.top/k));S(O*10)}return o(),window.addEventListener("scroll",o,{passive:!0}),()=>window.removeEventListener("scroll",o)},[]);const _=X(),y=n.useMemo(()=>t?.image_url||t?.images?.nodes?.[0]?.url||"",[t]),r=n.useMemo(()=>{if(!t)return 0;const o=t.priceRange?.minVariantPrice?.amount;return o!=null?Number(o):(t.price_cents??0)/100},[t]),l=n.useMemo(()=>t?`${_}/product/${t.handle||t.slug}`:_,[_,t]),d=n.useMemo(()=>t?`${t.title} | Afrodezea`:"Afrodezea",[t]),m=n.useMemo(()=>t?(t.description||"").replace(/<[^>]+>/g,"").slice(0,155):"",[t]),z=n.useMemo(()=>t?u(t.id):!1,[t,u]),h=n.useMemo(()=>{const o=(t?.description||"").replace(/<[^>]+>/g," ");return H(o)},[t]),L=n.useMemo(()=>t?.profile?{Floral:t.profile.floral??0,Fruity:t.profile.fruity??0,Woody:t.profile.woody??0,Fresh:t.profile.fresh??0,Spicy:t.profile.spice??0,Strength:t.profile.strength??0}:{Floral:h.floral,Fruity:h.fruity,Woody:h.woody,Fresh:h.fresh,Spicy:h.spicy,Strength:h.strength},[t,h]),B=n.useMemo(()=>a?{Floral:a.floral_avg,Fruity:a.fruity_avg,Woody:a.woody_avg,Fresh:a.fresh_avg,Spicy:a.spicy_avg,Strength:a.strength_avg}:null,[a]),M=n.useMemo(()=>{if(!B)return L;const o=["Floral","Fruity","Woody","Fresh","Spicy","Strength"],p={};return o.forEach(k=>{p[k]=Math.round(((L[k]??0)+(B[k]??0))/2)}),p},[L,B]);if(C)return e.createElement("div",{style:{padding:24}},"Loading…");if(!t)return e.createElement("div",{style:{padding:24}},"Not found.");const A={"@context":"https://schema.org","@type":"Product",name:t.title,image:t.image_url?[t.image_url]:[],description:m,brand:{"@type":"Brand",name:"Afrodezea"},offers:{"@type":"Offer",priceCurrency:"USD",price:Number(r).toFixed(2),availability:"https://schema.org/InStock",url:l},...a?.count_verified>0?{aggregateRating:{"@type":"AggregateRating",ratingValue:Math.round((a.floral_avg+a.fruity_avg+a.woody_avg+a.fresh_avg+a.spicy_avg)/5*10)/10,reviewCount:a.count_verified}}:{}};return e.createElement("div",{className:"container",style:{padding:24,display:"grid",gap:18}},e.createElement(q,null,e.createElement("title",null,d),e.createElement("meta",{name:"description",content:m}),e.createElement("link",{rel:"canonical",href:l}),e.createElement("meta",{property:"og:type",content:"product"}),e.createElement("meta",{property:"og:title",content:d}),e.createElement("meta",{property:"og:description",content:m}),e.createElement("meta",{property:"og:url",content:l}),t.image_url&&e.createElement("meta",{property:"og:image",content:t.image_url}),e.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),e.createElement("script",{type:"application/ld+json"},JSON.stringify(A))),e.createElement("section",{className:"surface",style:{padding:18}},e.createElement("div",{style:{display:"grid",gap:20,gridTemplateColumns:"min(560px, 42vw) 1fr",alignItems:"start"}},e.createElement("div",{ref:b,style:{borderRadius:16,overflow:"hidden",border:"1px solid var(--hairline)",background:"#0a0a0a",aspectRatio:"1 / 1",transform:`translateY(${x}px)`,transition:"transform .08s linear",willChange:"transform"}},y?e.createElement(I,{fallback:e.createElement("div",{style:{opacity:.8}},"Gallery is unavailable.")},e.createElement(ee,{src:y,alt:t.title,aspect:1,imgHints:{loading:"eager",fetchpriority:"high",decoding:"async",sizes:"(min-width: 900px) 560px, 90vw"}})):null),e.createElement("div",{style:{display:"grid",gap:12}},e.createElement("div",{style:{borderBottom:"1px solid var(--hairline)",paddingBottom:12}},e.createElement("h1",{className:"display",style:{marginBottom:4}},t.title),t.collection&&e.createElement("div",{style:{opacity:.75}},t.collection)),f?.length?e.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:12}},f.map(o=>e.createElement("span",{key:o.id,style:{padding:"6px 10px",borderRadius:999,border:"1px solid var(--hairline)",opacity:.85}},new Date(o.created_at).toLocaleDateString()," • Str ",o.strength))):null,e.createElement("div",{style:{display:"flex",alignItems:"center",gap:12}},e.createElement("strong",{style:{color:"var(--gold)",fontSize:22}},re(r)),e.createElement("button",{className:"btn btn--gold",onClick:()=>g({productId:t.id,title:t.title,variantId:`${t.id}:default`,variantTitle:"Default",image:y?{url:y}:null,price:{amount:r,currencyCode:"USD"},qty:1})},"Add to Cart"),e.createElement("button",{className:"btn btn--ghost",onClick:()=>c(t.id,{title:t.title,handle:t.handle??t.slug??null,image_url:y||null,price_cents:t.price_cents??Math.round(Number(r||0)*100),priceRange:t.priceRange||null}),"aria-pressed":z},z?"Remove from Wishlist":"Add to Wishlist")),t.description&&e.createElement("p",{style:{marginTop:8,opacity:.9}},t.description)))),e.createElement("section",{className:"surface",style:{padding:18}},e.createElement("h3",{style:{margin:0,marginBottom:12}},"Scent Profile"),e.createElement("div",{style:{display:"grid",gap:16,gridTemplateColumns:"min(380px, 40%) 1fr",alignItems:"center"}},e.createElement(n.Suspense,{fallback:null},e.createElement(I,{fallback:e.createElement("div",{style:{opacity:.8}},"Profile visualization unavailable.")},e.createElement(te,{values:{Floral:M.Floral,Fruity:M.Fruity,Woody:M.Woody,Fresh:M.Fresh,Spicy:M.Spicy}}))),e.createElement("div",null,e.createElement("p",{className:"lead",style:{marginTop:0}},a?.count_verified?e.createElement(e.Fragment,null,"Blended from ",e.createElement("strong",null,a.count_verified," verified rating",a.count_verified>1?"s":"")," + our profile."):"Be the first to rate this profile."),e.createElement("div",{style:{maxWidth:520,marginTop:10}},e.createElement(Z,{value:M.Strength})),e.createElement("div",{style:{marginTop:12}},e.createElement("button",{className:"btn btn--gold",onClick:()=>E(!0)},"Rate this Candle’s Profile"))))),e.createElement(n.Suspense,{fallback:null},e.createElement(ne,{open:W,onClose:()=>E(!1),product:t,prefillEmail:D,rateToken:$})))}export{se as default};
