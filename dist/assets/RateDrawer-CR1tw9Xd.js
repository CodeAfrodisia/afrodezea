import{f as S,r as a,R as e}from"./index-Du-y3j9l.js";import{s as k}from"./ratings-BrickCnm.js";S();function o(l){const r=Number(l??0);return Number.isNaN(r)?0:Math.max(0,Math.min(5,r))}const R=["floral","fruity","woody","fresh","spicy","strength"];function D({open:l,onClose:r,product:m,prefillEmail:w=""}){const[c,x]=a.useState(w),[i,d]=a.useState({floral:0,fruity:0,woody:0,fresh:0,spicy:0,strength:3}),[f,y]=a.useState(!1),[g,u]=a.useState(""),p=a.useRef(null),b=a.useRef(null);a.useEffect(()=>{if(!l)return;const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}},[l]),a.useEffect(()=>{l&&(d({floral:0,fruity:0,woody:0,fresh:0,spicy:0,strength:3}),u(""),setTimeout(()=>b.current?.focus(),0))},[l,m?.id]),a.useEffect(()=>{if(!l)return;function t(n){if(n.key==="Escape"&&r?.(),n.key!=="Tab")return;const s=p.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!s||s.length===0)return;const E=s[0],h=s[s.length-1];n.shiftKey&&document.activeElement===E?(h.focus(),n.preventDefault()):!n.shiftKey&&document.activeElement===h&&(E.focus(),n.preventDefault())}return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[l,r]);const v=a.useMemo(()=>!c||/\S+@\S+\.\S+/.test(c),[c]);if(!l)return null;async function N(){if(u(""),!!m?.id){if(!v){u("Please enter a valid email (or leave it blank).");return}y(!0);try{await k({product_id:m.id,email:c||null,floral:o(i.floral),fruity:o(i.fruity),woody:o(i.woody),fresh:o(i.fresh),spicy:o(i.spicy),strength:o(i.strength),token:rateToken||void 0}),r?.()}catch(t){console.error(t),u(t.message||"Something went wrong.")}finally{y(!1)}}}return e.createElement("div",{className:"modal-veil",onClick:t=>t.target===t.currentTarget&&r?.()},e.createElement("div",{ref:p,className:"glass modal-card",style:{width:"min(720px,92vw)"}},e.createElement("div",{className:"glass-header"},e.createElement("div",{style:{display:"grid"}},e.createElement("div",{className:"modalTitle"},"Rate this Candle’s Profile"),e.createElement("small",{style:{opacity:.7}},m?.title||"—")),e.createElement("button",{className:"btn btn--icon",onClick:r,"aria-label":"Close"},"✕")),e.createElement("div",{style:{padding:16,display:"grid",gap:14}},e.createElement("div",null,e.createElement("label",{style:{display:"block",marginBottom:6,opacity:.85}},"Email (optional, for purchase verification later)"),e.createElement("input",{ref:b,className:"input",placeholder:"you@example.com",value:c,onChange:t=>x(t.target.value),style:{borderColor:v?void 0:"crimson"}})),e.createElement("div",{style:{display:"grid",gap:10}},R.map(t=>e.createElement("div",{key:t,style:{display:"grid",gridTemplateColumns:"140px 1fr",alignItems:"center",gap:10}},e.createElement("label",{style:{textTransform:"capitalize",opacity:.9}},t),e.createElement("input",{type:"range",min:"0",max:"5",value:i[t],onChange:n=>d(s=>({...s,[t]:Number(n.target.value)}))})))),g?e.createElement("div",{style:{color:"#ffb3b3"}},g):null,e.createElement("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"}},e.createElement("button",{className:"btn btn--ghost",onClick:r,disabled:f},"Cancel"),e.createElement("button",{className:"btn btn--gold",onClick:N,disabled:f},f?"Sending…":"Submit Rating")))))}export{D as default};
